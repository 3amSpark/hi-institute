---
import NavLink from "./nav-link.astro";
import MobileNavLink from "./mobile-nav-link.astro";

const dropdownLinkClass =
  "font-heading text-brand-gray/70 hover:bg-ziggurat/10 hover:text-smokey-pink block rounded px-3 py-2 text-sm font-medium uppercase transition-colors";

// TODO: Use the old naming convention to keep Google Search Console happy
const routes = [
  {
    href: "/dermatologia",
    label: "DERMATOLOGÍA",
    children: [
      { href: "/dermatologia/piel", label: "DERMATOLOGÍA DE LA PIEL" },
      { href: "/dermatologia/cabello", label: "DERMATOLOGÍA DEL CABELLO" },
    ],
  },
  { href: "/medicina-laser", label: "MEDICINA LÁSER", exact: true },
  {
    href: "/los-mas-solicitados",
    label: "LOS MÁS SOLICITADOS",
    children: [
      { href: "/los-mas-solicitados/marcas-de-acne", label: "MARCAS DE ACNÉ" },
      { href: "/los-mas-solicitados/rosacea", label: "ROSÁCEA" },
      { href: "/los-mas-solicitados/manchas", label: "MANCHAS" },
      {
        href: "/los-mas-solicitados/suavizado-de-arrugas",
        label: "SUAVIZADO DE ARRUGAS",
      },
    ],
  },
  {
    href: "/rejuvenecimiento",
    label: "REJUVENECIMIENTO",
    children: [
      { href: "/rejuvenecimiento/inyectables", label: "INYECTABLES" },
      { href: "/rejuvenecimiento/ultra-clear", label: "ULTRA CLEAR" },
    ],
  },
  { href: "/hidrafaciales", label: "HIDRAFACIALES", exact: true },
  { href: "/depilacion-laser", label: "DEPILACIÓN LÁSER", exact: true },
  {
    href: "/analisis-3d-del-rostro",
    label: "ANÁLISIS 3D DEL ROSTRO",
    exact: true,
  },
];
---

<!-- Mobile Menu Overlay -->
<div
  id="mobile-menu-overlay"
  class="pointer-events-none fixed inset-0 top-20 z-40 bg-black/0 transition-all duration-200 lg:hidden"
>
</div>

<!-- Mobile Menu -->
<div
  id="mobile-menu"
  class="pointer-events-none fixed inset-x-0 top-20 z-40 h-[calc(100dvh-5rem)] -translate-y-2 overflow-y-auto bg-white opacity-0 transition-all duration-200 xl:hidden"
>
  <div class="flex h-full flex-col">
    {
      routes.map((route, i) => (
        <>
          <MobileNavLink href={route.href}>{route.label}</MobileNavLink>
          {route.children?.slice(1).map((child) => (
            <MobileNavLink href={child.href} isChild>
              {child.label}
            </MobileNavLink>
          ))}
        </>
      ))
    }
  </div>
</div>

<nav
  class="border-brand-gray/10 fixed top-0 right-0 left-0 z-50 border-b bg-white/85 backdrop-blur-sm"
>
  <div class="max-w-8xl mx-auto px-4 sm:px-6 lg:px-8">
    <div class="flex h-20 items-center justify-between">
      <!-- Logo -->
      <a href="/" class="shrink-0">
        <!-- TODO: Replace with proper logo-->
        <img src="/logo.webp" alt="Skin Beauty" class="h-8 w-auto" />
      </a>

      <!-- Desktop Navigation -->
      <div class="hidden items-center gap-8 xl:flex">
        {
          routes.map((route) =>
            route.children ? (
              <NavLink href={route.href}>
                {route.label}
                <Fragment slot="dropdown">
                  {route.children.map((child) => (
                    <a href={child.href} class={dropdownLinkClass}>
                      {child.label}
                    </a>
                  ))}
                </Fragment>
              </NavLink>
            ) : (
              <NavLink href={route.href} exact={route.exact}>
                {route.label}
              </NavLink>
            )
          )
        }
      </div>

      <!-- Mobile Menu Button -->
      <button
        id="open-mobile-menu"
        class="group relative flex size-10 cursor-pointer flex-col items-center justify-center gap-1.5 xl:hidden"
        aria-label="Abrir menú"
      >
        <span
          class="bg-brand-gray h-0.5 w-6 origin-center transition-all duration-300 group-[.menu-open]:translate-y-[8px] group-[.menu-open]:rotate-45"
        ></span>
        <span
          class="bg-brand-gray h-0.5 w-6 transition-all duration-300 group-[.menu-open]:scale-0 group-[.menu-open]:opacity-0"
        ></span>
        <span
          class="bg-brand-gray h-0.5 w-6 origin-center transition-all duration-300 group-[.menu-open]:-translate-y-[8px] group-[.menu-open]:-rotate-45"
        ></span>
      </button>
    </div>
  </div>
</nav>

<script>
  const openBtn = document.getElementById("open-mobile-menu");
  const menu = document.getElementById("mobile-menu");
  const overlay = document.getElementById("mobile-menu-overlay");

  function openMenu() {
    menu?.classList.remove(
      "opacity-0",
      "-translate-y-2",
      "pointer-events-none"
    );
    menu?.classList.add("opacity-100", "translate-y-0", "pointer-events-auto");
    overlay?.classList.remove("bg-black/0", "pointer-events-none");
    overlay?.classList.add("bg-black/30", "pointer-events-auto");
    openBtn?.classList.add("menu-open");
    document.body.classList.add("overflow-hidden");
  }

  function closeMenu() {
    menu?.classList.add("opacity-0", "-translate-y-2", "pointer-events-none");
    menu?.classList.remove(
      "opacity-100",
      "translate-y-0",
      "pointer-events-auto"
    );
    overlay?.classList.add("bg-black/0", "pointer-events-none");
    overlay?.classList.remove("bg-black/30", "pointer-events-auto");
    openBtn?.classList.remove("menu-open");
    document.body.classList.remove("overflow-hidden");
  }

  openBtn?.addEventListener("click", () => {
    const isOpen = menu?.classList.contains("opacity-100");
    if (isOpen) {
      closeMenu();
    } else {
      openMenu();
    }
  });

  overlay?.addEventListener("click", closeMenu);
</script>
