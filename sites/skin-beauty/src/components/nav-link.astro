---
import ChevronDown from "@repo/ui/icons/chevron-down.astro";

interface Props {
  href: string;
  class?: string;
  /** Match exact path only (default: false - also matches child routes) */
  exact?: boolean;
}

const { href, class: className, exact = false, ...rest } = Astro.props;
const pathname = Astro.url.pathname;

// Normalize paths by removing trailing slashes for comparison
const normalizedHref = href.replace(/\/$/, "") || "/";
const normalizedPathname = pathname.replace(/\/$/, "") || "/";

const isActive = exact
  ? normalizedPathname === normalizedHref
  : normalizedPathname === normalizedHref ||
    normalizedPathname.startsWith(normalizedHref + "/");

const hasDropdown = Astro.slots.has("dropdown");
const baseLinkClasses =
  "font-heading hover:text-brand text-smaller inline-flex items-center font-medium tracking-wide uppercase transition-colors";
const activeClasses = isActive
  ? "text-brand font-semibold"
  : "text-brand-gray/90";
---

{
  hasDropdown ? (
    <div class="group relative flex h-full items-center" data-dropdown>
      <a
        href={href}
        class:list={[baseLinkClasses, "gap-1", activeClasses, className]}
        aria-current={isActive ? "page" : undefined}
        {...rest}
      >
        <slot />
        <ChevronDown class="size-4 stroke-2 transition-transform duration-300 group-hover:rotate-180" />
      </a>
      <div class="pointer-events-none absolute top-full left-0 z-50 min-w-48 pt-2 opacity-0 transition-opacity group-hover:pointer-events-auto group-hover:opacity-100">
        <div class="rounded-lg border border-gray-100 bg-white p-2 shadow-lg">
          <slot name="dropdown" />
        </div>
      </div>
    </div>
  ) : (
    <a
      href={href}
      class:list={[baseLinkClasses, activeClasses, className]}
      aria-current={isActive ? "page" : undefined}
      {...rest}
    >
      <slot />
    </a>
  )
}
