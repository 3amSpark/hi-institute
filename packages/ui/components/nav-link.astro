---
import ChevronDown from "@repo/ui/icons/chevron-down.astro";

interface Props {
  href: string;
  class?: string;
  /** Match exact path only (default: false - also matches child routes) */
  exact?: boolean;
  activeClass?: string;
  baseClass?: string;
}

const {
  href,
  class: className,
  exact = false,
  activeClass = "text-brand font-semibold",
  baseClass = "font-heading hover:text-brand text-smaller inline-flex items-center font-medium tracking-wide uppercase transition-colors",
  ...rest
} = Astro.props;
const pathname = Astro.url.pathname;

// Normalize paths by removing trailing slashes for comparison
const normalizedHref = href.replace(/\/$/, "") || "/";
const normalizedPathname = pathname.replace(/\/$/, "") || "/";

const isActive = exact
  ? normalizedPathname === normalizedHref
  : normalizedPathname === normalizedHref ||
    normalizedPathname.startsWith(normalizedHref + "/");

const hasDropdown = Astro.slots.has("dropdown");
---

{
  hasDropdown ? (
    <div class="group relative flex h-full items-center" data-dropdown>
      <a
        href={href}
        class:list={[
          baseClass,
          "gap-1",
          isActive ? activeClass : "text-brand-gray/85",
          className,
        ]}
        aria-current={isActive ? "page" : undefined}
        {...rest}
      >
        <slot />
        <ChevronDown class="size-4 stroke-2 transition-transform duration-300 group-hover:rotate-180" />
      </a>
      <div class="pointer-events-none absolute top-full left-0 z-50 min-w-48 origin-top-left pt-2 opacity-0 scale-90 transition-all duration-200 ease-out group-hover:pointer-events-auto group-hover:opacity-100 group-hover:scale-100">
        <div class="rounded-lg border-[0.5px] border-gray-600/10 bg-white p-2 shadow-lg">
          <slot name="dropdown" />
        </div>
      </div>
    </div>
  ) : (
    <a
      href={href}
      class:list={[
        baseClass,
        isActive ? activeClass : "text-brand-gray/90",
        className,
      ]}
      aria-current={isActive ? "page" : undefined}
      {...rest}
    >
      <slot />
    </a>
  )
}
